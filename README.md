# easemob-callkit-signaflow

ç¯ä¿¡CallKitä¿¡ä»¤è·Ÿè¸ªå¯è§†åŒ–å·¥å…·åº“ï¼Œç”¨äºè§£æå’Œå¯è§†åŒ–CallKitä¿¡ä»¤æ—¥å¿—ï¼Œç”Ÿæˆæ¸…æ™°çš„åºåˆ—å›¾å’ŒæŠ¥å‘Šã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“Š **ä¿¡ä»¤æ—¥å¿—è§£æ**ï¼šè‡ªåŠ¨è§£æç¯ä¿¡CallKitç”Ÿæˆçš„ä¿¡ä»¤æ—¥å¿—æ–‡ä»¶
- ğŸ“ˆ **å¯è§†åŒ–æŠ¥å‘Š**ï¼šç”ŸæˆHTMLæ ¼å¼çš„å¯è§†åŒ–æŠ¥å‘Šï¼ŒåŒ…å«é€šè¯åˆ—è¡¨å’Œä¿¡ä»¤åºåˆ—å›¾
- ğŸ§© **Mermaidæ”¯æŒ**ï¼šæ”¯æŒç”ŸæˆMermaidæ ¼å¼çš„åºåˆ—å›¾æ•°æ®
- ğŸ–¥ï¸ **WebæœåŠ¡**ï¼šæä¾›Webç•Œé¢ï¼Œæ”¯æŒä¸Šä¼ æ—¥å¿—æ–‡ä»¶ç”ŸæˆæŠ¥å‘Š
- ğŸ“± **å‘½ä»¤è¡Œå·¥å…·**ï¼šæä¾›CLIæ¥å£ï¼Œæ”¯æŒæ‰¹é‡å¤„ç†æ—¥å¿—æ–‡ä»¶
- ğŸ·ï¸ **é€šè¯åˆ†ç±»**ï¼šè‡ªåŠ¨è¯†åˆ«ä¸€å¯¹ä¸€ã€ç¾¤ç»„å’ŒæœªçŸ¥ç±»å‹çš„é€šè¯
- ğŸ” **å¿«é€Ÿå¯¼èˆª**ï¼šé€šè¿‡é€šè¯IDåˆ—è¡¨å¿«é€Ÿå®šä½åˆ°ç‰¹å®šé€šè¯è¯¦æƒ…

## é¡¹ç›®ç»“æ„

```
easemob-callkit-signaflow/
â”œâ”€â”€ src/                          # TypeScriptæºç ç›®å½•
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒé€»è¾‘æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ Types.ts              # ä¿¡ä»¤æ•°æ®ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ SignalParser.ts       # æ—¥å¿—è§£æå™¨ï¼ˆè¾“å…¥logâ†’è¾“å‡ºä¿¡ä»¤äº‹ä»¶ï¼‰
â”‚   â”‚   â””â”€â”€ Visualizer.ts         # å¯è§†åŒ–ç”Ÿæˆå™¨ï¼ˆä¿¡ä»¤äº‹ä»¶â†’HTML/Mermaidï¼‰
â”‚   â”œâ”€â”€ app.ts                    # ExpressæœåŠ¡ï¼ˆæä¾›äº¤äº’å¼Webç•Œé¢ï¼‰
â”‚   â””â”€â”€ index.ts                  # CLIå‘½ä»¤å…¥å£ï¼ˆç”¨æˆ·æ‰§è¡Œå…¥å£ï¼‰
â”œâ”€â”€ logInput/                     # ç¤ºä¾‹æ—¥å¿—æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ easemob.log               # ç¤ºä¾‹ä¿¡ä»¤æ—¥å¿—
â”œâ”€â”€ package.json                  # é¡¹ç›®é…ç½®ï¼ˆå«npmè„šæœ¬å’Œä¾èµ–ï¼‰
â”œâ”€â”€ tsconfig.json                 # TypeScripté…ç½®ï¼ˆç±»å‹æ£€æŸ¥è§„åˆ™ï¼‰
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜ï¼ˆå«ä½¿ç”¨ç¤ºä¾‹ï¼‰
```

## å®‰è£…

### å‰ææ¡ä»¶

- Node.js 18.x æˆ–æ›´é«˜ç‰ˆæœ¬
- npm æˆ– yarn åŒ…ç®¡ç†å™¨

### å®‰è£…æ­¥éª¤

1. å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°

```bash
git clone https://github.com/Easemob-Community/easemob-callkit-signaflow.git
cd easemob-callkit-signaflow
```

2. å®‰è£…ä¾èµ–

```bash
npm install
```

3. æ„å»ºé¡¹ç›®

```bash
npm run build
```

## ä½¿ç”¨æŒ‡å—

### 1. å‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰

#### è§£ææ—¥å¿—æ–‡ä»¶

```bash
node dist/index.js parse <logFile> [options]
```

**å‚æ•°è¯´æ˜**ï¼š
- `<logFile>`: ä¿¡ä»¤æ—¥å¿—æ–‡ä»¶è·¯å¾„
- `-o, --output <outputFile>`: è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼ˆå¯é€‰ï¼‰

**ç¤ºä¾‹**ï¼š
```bash
node dist/index.js parse logInput/easemob.log -o parsed-data.json
```

#### ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Š

```bash
node dist/index.js visualize <logFile> [options]
```

**å‚æ•°è¯´æ˜**ï¼š
- `<logFile>`: ä¿¡ä»¤æ—¥å¿—æ–‡ä»¶è·¯å¾„
- `-f, --format <format>`: æŠ¥å‘Šæ ¼å¼ï¼ˆhtml æˆ– mermaidï¼Œé»˜è®¤ï¼šhtmlï¼‰
- `-o, --output <outputFile>`: è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼ˆå¯é€‰ï¼‰

**ç¤ºä¾‹**ï¼š
```bash
# ç”ŸæˆHTMLæŠ¥å‘Š
node dist/index.js visualize logInput/easemob.log -o report.html

# ç”ŸæˆMermaidæ•°æ®æ–‡ä»¶
node dist/index.js visualize logInput/easemob.log -f mermaid -o sequence.mmd
```

#### å°†Mermaidæ•°æ®è½¬æ¢ä¸ºHTML

```bash
node dist/index.js mermaid-to-html <mermaidFile> [options]
```

**å‚æ•°è¯´æ˜**ï¼š
- `<mermaidFile>`: Mermaidæ•°æ®æ–‡ä»¶è·¯å¾„
- `-o, --output <outputFile>`: è¾“å‡ºHTMLæ–‡ä»¶è·¯å¾„ï¼ˆå¯é€‰ï¼‰

**ç¤ºä¾‹**ï¼š
```bash
node dist/index.js mermaid-to-html sequence.mmd -o mermaid-report.html
```

#### å¯åŠ¨WebæœåŠ¡

```bash
node dist/index.js serve [options]
```

**å‚æ•°è¯´æ˜**ï¼š
- `-p, --port <port>`: æœåŠ¡ç«¯å£ï¼ˆé»˜è®¤ï¼š3000ï¼‰

**ç¤ºä¾‹**ï¼š
```bash
node dist/index.js serve -p 8080
```

### 2. WebæœåŠ¡

å¯åŠ¨WebæœåŠ¡åï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—® `http://localhost:3000`ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **ä¸Šä¼ æ—¥å¿—æ–‡ä»¶**ï¼šé€‰æ‹©ä¿¡ä»¤æ—¥å¿—æ–‡ä»¶
2. **é€‰æ‹©æŠ¥å‘Šæ ¼å¼**ï¼šHTMLæˆ–Mermaid
3. **ç”ŸæˆæŠ¥å‘Š**ï¼šç‚¹å‡»æŒ‰é’®ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Š
4. **ä¸‹è½½æŠ¥å‘Š**ï¼šè‡ªåŠ¨ä¸‹è½½ç”Ÿæˆçš„æŠ¥å‘Šæ–‡ä»¶

## å¯è§†åŒ–æŠ¥å‘Šè¯´æ˜

ç”Ÿæˆçš„HTMLæŠ¥å‘ŠåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

### 1. ç»Ÿè®¡ä¿¡æ¯

- æ€»é€šè¯æ•°
- ä¸€å¯¹ä¸€é€šè¯æ•°
- ç¾¤ç»„é€šè¯æ•°
- æœªçŸ¥ç±»å‹é€šè¯æ•°

### 2. é€šè¯IDåˆ—è¡¨

- æ˜¾ç¤ºæ‰€æœ‰é€šè¯çš„CallID
- æ¯ä¸ªCallIDå‰æ˜¾ç¤ºé€šè¯ç±»å‹æ ‡è¯†ï¼š
  - ã€ä¸€å¯¹ä¸€ã€‘ï¼šç»¿è‰²æ ‡è¯†
  - ã€ç¾¤ç»„ã€‘ï¼šè“è‰²æ ‡è¯†
  - ã€æœªçŸ¥ã€‘ï¼šçº¢è‰²æ ‡è¯†
- ç‚¹å‡»CallIDå¯å¿«é€Ÿè·³è½¬åˆ°å¯¹åº”é€šè¯è¯¦æƒ…

### 3. é€šè¯è¯¦æƒ…

æ¯ä¸ªé€šè¯è¯¦æƒ…åŒ…å«ï¼š
- ä¿¡ä»¤åºåˆ—å›¾ï¼ˆä½¿ç”¨Mermaidç”Ÿæˆï¼‰
- è¯¦ç»†ä¿¡ä»¤æ—¥å¿—åˆ—è¡¨
- åŸå§‹æ—¥å¿—å†…å®¹

## APIæ¥å£

### WebæœåŠ¡API

#### å¥åº·æ£€æŸ¥

```
GET /health
```

**å“åº”**ï¼š
```json
{
  "status": "ok",
  "timestamp": "2025-12-18T00:00:00.000Z"
}
```

#### è§£ææ—¥å¿—

```
POST /api/parse
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "logContent": "æ—¥å¿—å†…å®¹"
}
```

**å“åº”**ï¼š
```json
{
  "message": "è§£æAPIå·²åˆ›å»ºï¼Œå…·ä½“å®ç°å°†åœ¨åç»­æ·»åŠ ",
  "received": {"logContent": "æ—¥å¿—å†…å®¹"}
}
```

#### ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Š

```
POST /api/visualize
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "logContent": "æ—¥å¿—å†…å®¹",
  "format": "html"
}
```

**å“åº”**ï¼š
```json
{
  "message": "å¯è§†åŒ–APIå·²åˆ›å»ºï¼Œå…·ä½“å®ç°å°†åœ¨åç»­æ·»åŠ ",
  "received": {"format": "html"}
}
```

#### Mermaidè½¬HTML

```
POST /api/mermaid-to-html
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "mermaidContent": "sequenceDiagram...",
  "outputFileName": "report.html"
}
```

**å“åº”**ï¼šHTMLæ–‡ä»¶ä¸‹è½½

## å¼€å‘æŒ‡å—

### å®‰è£…ä¾èµ–

```bash
npm install
```

### æ„å»ºé¡¹ç›®

```bash
npm run build
```

### ç±»å‹æ£€æŸ¥

```bash
npx tsc --noEmit
```

### å¼€å‘æ¨¡å¼ï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–ï¼‰

```bash
npx tsc --watch
```

### npmè„šæœ¬è¯´æ˜

| è„šæœ¬å‘½ä»¤                | è¯´æ˜                                  |
|-------------------------|---------------------------------------|
| `npm run build`         | ç¼–è¯‘TypeScriptä»£ç åˆ°distç›®å½•          |
| `npm run preprocess`    | è¿è¡Œæ—¥å¿—é¢„å¤„ç†è„šæœ¬                    |
| `npm run preprocess:dev`| ç¼–è¯‘å¹¶è¿è¡Œæ—¥å¿—é¢„å¤„ç†è„šæœ¬              |
| `npm run parse`         | è¿è¡Œæ—¥å¿—è§£æè„šæœ¬                      |
| `npm run parse:dev`     | ç¼–è¯‘å¹¶è¿è¡Œæ—¥å¿—è§£æè„šæœ¬                |
| `npm run process`       | è¿è¡Œæ•°æ®å¤„ç†è„šæœ¬                      |
| `npm run process:dev`   | ç¼–è¯‘å¹¶è¿è¡Œæ•°æ®å¤„ç†è„šæœ¬                |
| `npm test`              | è¿è¡Œæµ‹è¯•ï¼ˆå½“å‰æœªå®ç°å…·ä½“æµ‹è¯•ç”¨ä¾‹ï¼‰    |

## æŠ€æœ¯æ ˆ

- **TypeScript**: ç±»å‹å®‰å…¨çš„JavaScriptè¶…é›†
- **Node.js**: æœåŠ¡å™¨ç«¯JavaScriptè¿è¡Œæ—¶
- **Express**: Webåº”ç”¨æ¡†æ¶
- **Mermaid.js**: åºåˆ—å›¾ç”Ÿæˆåº“
- **Commander.js**: CLIå‘½ä»¤è¡Œå·¥å…·
- **fs-extra**: æ–‡ä»¶ç³»ç»Ÿæ“ä½œåº“

## è®¸å¯è¯

ISC License

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ä»¬ï¼š

- GitHub Issues: https://github.com/Easemob-Community/easemob-callkit-signaflow/issues
- ç¯ä¿¡å®˜ç½‘: https://www.easemob.com/

## æ›´æ–°æ—¥å¿—

### v1.0.1 (2025-12-19)

- å¢åŠ äº†AIæ¨¡å‹é€‰é¡¹ï¼šåœ¨AIåˆ†æé…ç½®ä¸­æ·»åŠ äº†"é€šä¹‰åƒé—®Long"æ¨¡å‹æ”¯æŒ
- ä¼˜åŒ–äº†AIç³»ç»Ÿæç¤ºè¯ï¼šè¦æ±‚è¯¦ç»†åˆ†æä½†ç®€æ´å›å¤ï¼Œç›´æŒ‡é—®é¢˜è¦å®³
- æ›´æ–°äº†AI APIè¯·æ±‚å’Œå“åº”å¤„ç†é€»è¾‘ï¼Œç¡®ä¿æ”¯æŒæ–°æ·»åŠ çš„qwen-longæ¨¡å‹

### v1.0.0 (2025-12-17)

- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒè§£æç¯ä¿¡CallKitä¿¡ä»¤æ—¥å¿—
- æ”¯æŒç”ŸæˆHTMLå’ŒMermaidæ ¼å¼çš„å¯è§†åŒ–æŠ¥å‘Š
- æä¾›CLIå’ŒWebæœåŠ¡ä¸¤ç§ä½¿ç”¨æ–¹å¼
- è‡ªåŠ¨è¯†åˆ«é€šè¯ç±»å‹å¹¶åˆ†ç±»æ˜¾ç¤º
- æ”¯æŒé€šè¿‡é€šè¯IDåˆ—è¡¨å¿«é€Ÿå¯¼èˆª